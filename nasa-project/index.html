<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Climate Anomaly Predictions | NASA Space Apps</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js for data visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Custom styles to complement Tailwind */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* Slate-50, a soft off-white */
            color: #1e293b; /* Slate-800, for primary text */
        }
        .card {
            background-color: #ffffff;
            border: 1px solid #e2e8f0; /* Slate-200 */
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        .btn-primary {
            background-color: #3b82f6; /* Blue-500 */
            transition: background-color 0.3s ease, transform 0.2s ease;
        }
        .btn-primary:hover {
            background-color: #2563eb; /* Blue-600 */
            transform: translateY(-2px);
        }
        .btn-primary:disabled {
            background-color: #94a3b8; /* Slate-400 */
            cursor: not-allowed;
            transform: none;
        }
        .scenario-radio:checked + label {
            background-color: #3b82f6;
            border-color: #2563eb;
            color: #ffffff;
            font-weight: 500;
        }
        .loader {
            border-top-color: #3b82f6;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4 sm:p-6 lg:p-8">

    <div class="w-full max-w-6xl mx-auto">
        <!-- Header Section -->
        <header class="text-center mb-10">
            <h1 class="text-4xl md:text-5xl font-bold text-slate-900 tracking-tight">Global Temperature Anomaly</h1>
            <p class="mt-3 text-lg text-slate-600">Visualizing Climate Projections Using NASA Data</p>
        </header>

        <main class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            <!-- Controls Section -->
            <div class="lg:col-span-4 xl:col-span-3 p-6 card rounded-2xl">
                <h2 class="text-2xl font-semibold text-slate-800 border-b border-slate-200 pb-4 mb-5">Control Panel</h2>
                
                <!-- Scenario Selection -->
                <div class="mb-6">
                    <h3 class="text-base font-medium mb-3 text-slate-600">1. Select Emission Scenario</h3>
                    <div class="space-y-3">
                        <div>
                            <input type="radio" id="low-scenario" name="scenario" value="low" class="hidden scenario-radio">
                            <label for="low-scenario" class="block w-full text-center px-4 py-3 rounded-lg border border-slate-300 cursor-pointer transition-all duration-200 hover:border-blue-500 hover:bg-blue-50">Low Emissions</label>
                        </div>
                        <div>
                            <input type="radio" id="medium-scenario" name="scenario" value="medium" class="hidden scenario-radio" checked>
                            <label for="medium-scenario" class="block w-full text-center px-4 py-3 rounded-lg border border-slate-300 cursor-pointer transition-all duration-200 hover:border-blue-500 hover:bg-blue-50">Medium Emissions</label>
                        </div>
                        <div>
                            <input type="radio" id="high-scenario" name="scenario" value="high" class="hidden scenario-radio">
                            <label for="high-scenario" class="block w-full text-center px-4 py-3 rounded-lg border border-slate-300 cursor-pointer transition-all duration-200 hover:border-blue-500 hover:bg-blue-50">High Emissions</label>
                        </div>
                    </div>
                </div>

                <!-- Action Button -->
                <div>
                     <h3 class="text-base font-medium mb-3 text-slate-600">2. Generate Projection</h3>
                    <button id="predict-btn" class="w-full btn-primary text-white font-bold py-3 px-4 rounded-lg shadow-lg flex items-center justify-center">
                        <span id="btn-text">Run Prediction</span>
                        <div id="loader" class="loader ease-linear rounded-full border-4 border-t-4 border-gray-200 h-6 w-6 ml-3 hidden"></div>
                    </button>
                </div>
                 <p id="error-message" class="text-red-500 mt-4 text-sm text-center font-medium"></p>
            </div>

            <!-- Chart Display Section -->
            <div class="lg:col-span-8 xl:col-span-9 p-6 card rounded-2xl">
                <div class="h-[500px] md:h-[600px]">
                    <canvas id="climateChart"></canvas>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="text-center mt-10 text-slate-500 text-sm">
            <p>A project for the NASA International Space Apps Challenge.</p>
            <p>Backend powered by FastAPI, Frontend by HTML, Tailwind CSS, and Chart.js.</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DOM Element References ---
            const predictBtn = document.getElementById('predict-btn');
            const btnText = document.getElementById('btn-text');
            const loader = document.getElementById('loader');
            const errorMessage = document.getElementById('error-message');
            const chartCanvas = document.getElementById('climateChart');

            // --- API Configuration ---
            const API_URL = 'http://127.0.0.1:8000/api/predict_anomaly';

            let climateChart; // To hold the chart instance

            // --- Chart Initialization ---
            function initializeChart() {
                const ctx = chartCanvas.getContext('2d');
                if (climateChart) {
                    climateChart.destroy();
                }
                climateChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: [{
                            label: 'Historical Anomaly (°C)',
                            data: [],
                            borderColor: 'rgb(100, 116, 139)', // Slate-500
                            backgroundColor: 'rgba(100, 116, 139, 0.1)',
                            borderWidth: 2.5,
                            pointRadius: 1.5,
                            pointBackgroundColor: 'rgb(100, 116, 139)',
                            tension: 0.2,
                            fill: true,
                        }, {
                            label: 'Predicted Anomaly (°C)',
                            data: [],
                            borderColor: 'rgb(59, 130, 246)', // Blue-500
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            borderWidth: 2.5,
                            pointRadius: 1.5,
                            pointBackgroundColor: 'rgb(59, 130, 246)',
                            borderDash: [6, 3], // Dashed line for prediction
                            tension: 0.2,
                            fill: true,
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        interaction: {
                            intersect: false,
                            mode: 'index',
                        },
                        plugins: {
                            legend: {
                                labels: {
                                    color: '#334155', // Slate-700
                                    font: { size: 14 }
                                }
                            },
                            title: {
                                display: true,
                                text: 'Global Temperature Anomaly (1980-2050)',
                                color: '#1e293b', // Slate-800
                                font: { size: 18, weight: '600' }
                            }
                        },
                        scales: {
                            x: {
                                title: {
                                    display: true,
                                    text: 'Year',
                                    color: '#475569', // Slate-600
                                    font: { size: 14, weight: '500' }
                                },
                                ticks: { color: '#475569' },
                                grid: { color: 'rgba(0, 0, 0, 0.05)' }
                            },
                            y: {
                                title: {
                                    display: true,
                                    text: 'Temperature Anomaly (°C)',
                                    color: '#475569', // Slate-600
                                    font: { size: 14, weight: '500' }
                                },
                                ticks: { color: '#475569' },
                                grid: { color: 'rgba(0, 0, 0, 0.05)' }
                            }
                        }
                    }
                });
            }

            // --- UI State Management ---
            function setLoadingState(isLoading) {
                predictBtn.disabled = isLoading;
                if (isLoading) {
                    btnText.textContent = 'Generating...';
                    loader.classList.remove('hidden');
                } else {
                    btnText.textContent = 'Run Prediction';
                    loader.classList.add('hidden');
                }
            }

            // --- API Call to Fetch Prediction Data ---
            async function fetchPrediction() {
                const selectedScenario = document.querySelector('input[name="scenario"]:checked').value;
                setLoadingState(true);
                errorMessage.textContent = '';

                try {
                    const response = await fetch(API_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ scenario: selectedScenario }),
                    });

                    if (!response.ok) {
                        throw new Error(`API error: ${response.statusText} (Status: ${response.status})`);
                    }

                    const data = await response.json();
                    updateChart(data);

                } catch (error) {
                    console.error('Failed to fetch prediction:', error);
                    errorMessage.textContent = 'Connection failed. Is the Python server running?';
                    updateChart([]); 
                } finally {
                    setLoadingState(false);
                }
            }
            
            // --- Update Chart with New Data ---
            function updateChart(data) {
                if (!data || !climateChart) return;
                
                const labels = data.map(d => d.year);
                const historicalData = data.map(d => d['Historical Anomaly (°C)']);
                const predictedData = data.map(d => d['Predicted Anomaly (°C)']);

                const lastHistoricalValue = historicalData.filter(v => v !== null).pop();
                if (lastHistoricalValue) {
                    const firstPredictionIndex = predictedData.findIndex(v => v !== null);
                    if (firstPredictionIndex > 0) {
                         predictedData[firstPredictionIndex - 1] = lastHistoricalValue;
                    }
                }
                
                climateChart.data.labels = labels;
                climateChart.data.datasets[0].data = historicalData;
                climateChart.data.datasets[1].data = predictedData;
                climateChart.update();
            }

            // --- Event Listeners ---
            predictBtn.addEventListener('click', fetchPrediction);

            // --- Initial Load ---
            initializeChart();
            fetchPrediction();
        });
    </script>
</body>
</html>

